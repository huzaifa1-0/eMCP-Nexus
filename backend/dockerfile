# Start with a Python 3.12 slim image
FROM python:3.12-slim

# Set the working directory to the root of the app
WORKDIR /app

# Install C compiler and build tools (for asyncpg/web3)
RUN apt-get update && apt-get install -y \
    build-essential \
    gcc \
    && rm -rf /var/lib/apt/lists/*

# Copy requirements file to the root (/app)
COPY requirements.txt .

# Install dependencies
RUN pip install --no-cache-dir -r requirements.txt

# ✅ FIX: Copy the code INTO a 'backend' folder
# This creates /app/backend/main.py, allowing "from backend import..." to work
COPY . ./backend

# ✅ FIX: Add /app to the Python path so it can find the 'backend' package
ENV PYTHONPATH=/app

# Expose port
EXPOSE 8000

# ✅ FIX: Run the app as a module (backend.main)
CMD ["uvicorn", "backend.main:app", "--host", "0.0.0.0", "--port", "8000"]